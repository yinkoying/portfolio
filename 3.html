import React, { useState, useEffect } from 'react';

// --- Icons ---
const Icon = ({ path, className = "w-5 h-5" }) => (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {path}
    </svg>
);

const icons = {
    dashboard: <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/>,
    file: (
        <>
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
        </>
    ),
    check: <path d="M20 6 9 17l-5-5"/>,
    clock: (
        <>
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
        </>
    ),
    alert: (
        <>
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </>
    ),
    users: (
        <>
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </>
    ),
    download: (
        <>
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
        </>
    ),
    chevronRight: <path d="m9 18 6-6-6-6"/>,
    bank: <path d="M3 21h18M5 21V7l8-4 8 4v14M8 10a2 2 0 1 0 4 0 2 2 0 1 0-4 0zM10 21v-4a2 2 0 1 1 4 0v4"/>
};

const phases = [
    { id: 1, name: "啟動 (Initiating)", status: "Completed", date: "Mar 2026", docs: [
        { code: "PMO-01", name: "專案章程 (Project Charter)", type: "PDF" },
        { code: "PMO-02", name: "利害關係人登記表", type: "XLS" }
    ]},
    { id: 2, name: "規劃 (Planning)", status: "Completed", date: "Apr 2026", docs: [
        { code: "PROD-02", name: "產品辦法細則 (Product Program)", type: "PDF" },
        { code: "IT-01", name: "系統需求規格說明書 (SRS)", type: "DOC" }
    ]},
    { id: 3, name: "執行 (Executing)", status: "Completed", date: "May-Jun 2026", docs: [
        { code: "RISK-01", name: "漂綠風險防範報告 (KYG)", type: "PDF" },
        { code: "LEGAL-01", name: "借貸契約增補條款", type: "PDF" }
    ]},
    { id: 4, name: "監控 (Monitoring)", status: "Completed", date: "Jun-Jul 2026", docs: [
        { code: "IT-02", name: "UAT 測試驗收報告", type: "PDF" },
        { code: "PILOT-01", name: "試點客戶回饋報告", type: "PPT" }
    ]},
    { id: 5, name: "上市/結案 (Closing)", status: "Released", date: "Aug 2026", docs: [
        { code: "OPS-01", name: "標準作業程序 (SOP)", type: "PDF" },
        { code: "MKT-01", name: "業務銷售懶人包", type: "JPG" },
        { code: "PMO-06", name: "專案結案報告", type: "PPT" }
    ]}
];

// 簡單的 SVG 圓餅圖元件 (取代 Chart.js 以確保穩定性)
const SimpleDoughnut = () => (
    <svg width="100%" height="100%" viewBox="0 0 40 40" className="rotate-[-90deg]">
        <circle cx="20" cy="20" r="15.915" fill="transparent" stroke="#e2e8f0" strokeWidth="5"></circle>
        <circle cx="20" cy="20" r="15.915" fill="transparent" stroke="#10b981" strokeWidth="5" strokeDasharray="100 0" strokeDashoffset="0"></circle>
    </svg>
);

export default function App() {
    return (
        <div className="min-h-screen flex flex-col md:flex-row text-slate-800 bg-[#f1f5f9] font-sans">
            <style>{`
                body { font-family: 'Noto Sans TC', sans-serif; }
                .font-mono { font-family: 'Roboto Mono', monospace; }
            `}</style>
            
            {/* Sidebar (Navigation) */}
            <aside className="w-full md:w-64 bg-[#002D56] text-white flex-shrink-0 flex flex-col">
                <div className="p-6 flex items-center gap-3 border-b border-white/10">
                    <Icon path={icons.bank} className="w-8 h-8 text-[#C5A065]" />
                    <div>
                        <h1 className="font-bold text-lg leading-none">Coco Bank</h1>
                        <span className="text-xs text-slate-400 font-mono">PMO SYSTEM</span>
                    </div>
                </div>
                <nav className="p-4 space-y-2 flex-1">
                    <div className="flex items-center gap-3 px-4 py-3 bg-white/10 rounded-lg text-[#C5A065] font-medium cursor-pointer border-l-4 border-[#C5A065]">
                        <Icon path={icons.dashboard} />
                        專案戰情室
                    </div>
                    <div className="flex items-center gap-3 px-4 py-3 hover:bg-white/5 rounded-lg text-slate-300 transition-colors cursor-pointer border-l-4 border-transparent">
                        <Icon path={icons.file} />
                        文件管理 (DMS)
                    </div>
                    <div className="flex items-center gap-3 px-4 py-3 hover:bg-white/5 rounded-lg text-slate-300 transition-colors cursor-pointer border-l-4 border-transparent">
                        <Icon path={icons.users} />
                        團隊成員
                    </div>
                </nav>
                <div className="p-6 border-t border-white/10">
                    <div className="bg-[#001A33] p-4 rounded-lg border border-white/5">
                        <div className="text-xs text-slate-400 mb-1">Current User</div>
                        <div className="font-bold">YIN, KOYING (PM)</div>
                        <div className="text-xs text-[#C5A065] mt-1">企金商品部</div>
                    </div>
                </div>
            </aside>

            {/* Main Content */}
            <main className="flex-1 p-6 md:p-10 overflow-y-auto">
                
                {/* Header */}
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 pb-6 border-b border-slate-200">
                    <div>
                        <div className="flex items-center gap-2 mb-2">
                            <span className="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded border border-blue-200 font-mono">PRJ-2026-SME-SLL</span>
                            <span className="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded border border-green-200 font-bold">Status: Closed</span>
                        </div>
                        <h2 className="text-3xl font-bold text-[#002D56]">中小企業永續連結貸款 (SME SLL)</h2>
                    </div>
                    <div className="text-left md:text-right mt-4 md:mt-0 bg-white p-3 rounded-lg border border-slate-200 shadow-sm">
                        <div className="text-xs text-slate-500 uppercase tracking-wider">Project Cycle</div>
                        <div className="font-bold text-lg text-slate-700">Mar 01 - Aug 31, 2026</div>
                    </div>
                </div>

                {/* KPI Cards (Dashboard Look) */}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                    {/* KPI 1: Progress */}
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between hover:shadow-md transition-shadow">
                        <div className="text-slate-500 text-sm mb-2 flex justify-between items-center">
                            總體進度 (Progress)
                            <Icon path={icons.check} className="w-4 h-4 text-green-500" />
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 relative">
                                <SimpleDoughnut />
                                <div className="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-slate-700">100%</div>
                            </div>
                            <div>
                                <div className="text-2xl font-bold text-slate-800">Done</div>
                                <div className="text-xs text-slate-400">已正式結案</div>
                            </div>
                        </div>
                    </div>

                    {/* KPI 2: Budget */}
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                        <div className="text-slate-500 text-sm mb-2 flex justify-between items-center">
                            預算執行率 (Budget)
                            <span className="text-green-700 bg-green-100 px-1.5 py-0.5 rounded text-xs font-bold border border-green-200">-5%</span>
                        </div>
                        <div className="text-2xl font-bold text-slate-800 font-mono">95.0%</div>
                        <div className="w-full bg-slate-100 h-1.5 mt-3 rounded-full overflow-hidden">
                            <div className="bg-[#C5A065] w-[95%] h-full"></div>
                        </div>
                        <div className="text-xs text-slate-400 mt-2 flex justify-between">
                            <span>Used: 2.83M</span>
                            <span>Total: 3.00M</span>
                        </div>
                    </div>

                    {/* KPI 3: Performance */}
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                        <div className="text-slate-500 text-sm mb-2">首月撥款績效 (KPI)</div>
                        <div className="text-2xl font-bold text-[#002D56] font-mono">NT$ 30M</div>
                        <div className="text-xs text-green-600 mt-2 flex items-center gap-1 font-medium">
                            <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M12 7a1 1 0 110-2 1 1 0 010 2zm1 2a1 1 0 10-2 0v6a1 1 0 102 0V9zm5.374 6.147a.75.75 0 00-1.248-.798l-3.328 5.202H6.202l-3.328-5.202a.75.75 0 00-1.248.798l3.75 5.859a.75.75 0 001.277 0l7.721-12.06z" clipRule="evenodd" transform="translate(0 -5)"/></svg>
                            目標達成率 150%
                        </div>
                    </div>

                    {/* KPI 4: Risk */}
                    <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
                        <div className="text-slate-500 text-sm mb-2">關鍵風險 (Risk)</div>
                        <div className="flex items-center gap-2 mb-2">
                            <div className="w-3 h-3 rounded-full bg-green-500 shadow-[0_0_8px_rgba(16,185,129,0.6)]"></div>
                            <span className="font-bold text-slate-700">Low (已緩釋)</span>
                        </div>
                        <div className="text-xs text-slate-500 border-t border-slate-100 pt-2">
                            KYG 機制運作正常，無漂綠通報
                        </div>
                    </div>
                </div>

                {/* Project Phases & Artifacts */}
                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div className="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                        <h3 className="font-bold text-[#002D56] flex items-center gap-2">
                            <Icon path={icons.file} className="w-5 h-5 text-[#C5A065]" />
                            專案階段與交付文件 (WBS Artifacts)
                        </h3>
                        <button className="text-xs bg-white border border-slate-300 px-3 py-1.5 rounded shadow-sm hover:bg-slate-50 text-slate-600 font-medium transition-colors">
                            Download All (.zip)
                        </button>
                    </div>
                    
                    <div className="divide-y divide-slate-100">
                        {phases.map((phase) => (
                            <div key={phase.id} className="p-6 hover:bg-slate-50/50 transition-colors group">
                                <div className="flex flex-col md:flex-row md:items-start gap-6">
                                    {/* Phase Status */}
                                    <div className="md:w-48 flex-shrink-0">
                                        <div className="flex items-center gap-2 mb-1">
                                            <div className={`w-2.5 h-2.5 rounded-full ${phase.status === 'Released' ? 'bg-[#C5A065]' : 'bg-[#002D56]'}`}></div>
                                            <h4 className="font-bold text-slate-800 text-lg">{phase.name}</h4>
                                        </div>
                                        <div className="text-xs text-slate-400 pl-5 flex items-center gap-1.5 font-mono">
                                            <Icon path={icons.clock} className="w-3.5 h-3.5" />
                                            {phase.date}
                                        </div>
                                    </div>

                                    {/* Documents Grid */}
                                    <div className="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        {phase.docs.map((doc, idx) => (
                                            <div key={idx} className="flex items-center gap-3 p-3 rounded-lg border border-slate-200 bg-white hover:border-[#C5A065] hover:shadow-md transition-all cursor-pointer group/doc">
                                                <div className={`w-10 h-10 rounded-lg flex items-center justify-center text-[10px] font-bold text-white shadow-sm
                                                    ${doc.type === 'PDF' ? 'bg-red-500' : 
                                                      doc.type === 'XLS' ? 'bg-green-600' : 
                                                      doc.type === 'DOC' ? 'bg-blue-600' : 
                                                      doc.type === 'PPT' ? 'bg-orange-500' : 'bg-slate-500'}`}>
                                                    {doc.type}
                                                </div>
                                                <div className="min-w-0 flex-1">
                                                    <div className="text-xs text-slate-400 font-mono mb-0.5">{doc.code}</div>
                                                    <div className="text-sm font-bold text-slate-700 truncate group-hover/doc:text-[#002D56] transition-colors">{doc.name}</div>
                                                </div>
                                                <Icon path={icons.download} className="w-4 h-4 text-slate-300 group-hover/doc:text-[#C5A065] transition-colors" />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

            </main>
        </div>
    );
};
